# Sprint 8.1: OCR-модернизация для индонезийских накладных

## 1. Детектор таблицы (YOLO/PP-Structure)

### Подготовительный этап (1-3 дня)
1. Создание рабочей среды и установка зависимостей
2. Быстрый сравнительный тест YOLO и PP-Structure
3. Сбор и разметка 50-100 изображений накладных (LabelImg/CVAT)

### Разработка (4-7 дней)
4. Создание интерфейса TableDetector
5. Реализация YOLOTableDetector
6. Реализация PaddleTableDetector
7. Фабрика детекторов (выбор по параметрам)

### Тестирование и интеграция (2-3 дня)
8. Юнит-тесты на точность детекции и извлечение ячеек
9. Интеграция с OCR-пайплайном (обработка ячеек вместо всей картинки)

---

## 2. Арифметический валидатор с автокоррекцией

### Подготовительный этап (1-2 дня)
1. Анализ ошибок в существующих данных, классификация кейсов
2. Создание структуры валидатора

### Разработка (3-5 дней)
3. Базовый класс Validator
4. Реализация ArithmeticValidator (qty × price = amount, PRICE_ZERO_LOST, QTY_SPLIT)
5. Интеграция с postprocessing

### Тестирование (2-3 дня)
6. Юнит-тесты на выявление и исправление ошибок
7. Интеграционное тестирование

---

## 3. Доменные sanity-правила

### Подготовительный этап (1-2 дня)
1. Сбор и формализация правил (единицы, диапазоны, штучные товары)
2. Создание структуры для загрузки правил

### Разработка (3-4 дня)
3. Загрузчик правил из CSV
4. Реализация DomainRulesValidator (UNIT_MISMATCH, диапазоны цен и др.)
5. Интеграция с postprocessing

### Тестирование (2 дня)
6. Юнит-тесты на выявление и исправление доменных ошибок

---

## 4. Тест-пак с аннотированными изображениями

### Подготовительный этап (2-3 дня)
1. Создание структуры папок для тестов
2. Сбор 300+ изображений, сортировка по сложности
3. Подготовка эталонной разметки (JSON)

### Разработка (5-7 дней)
4. Инфраструктура для автотестов (pytest + сравнение с ground truth)
5. Тесты для easy/medium/hard кейсов
6. Скрипты для валидации тест-пака
7. Настройка CI для автозапуска тестов

### Тестирование и документация (2-3 дня)
8. Запуск и отладка тест-пака
9. Документация по структуре и метрикам

---

## График внедрения (4 недели)
- Неделя 1: Детектор таблицы, подготовка базы для валидатора, сбор тестовых данных
- Неделя 2: Завершение детектора, интеграция, арифметический валидатор, разметка тестов
- Неделя 3: Доменные sanity-правила, интеграция валидаторов, инфраструктура тест-пака
- Неделя 4: Завершение тест-пака, CI, документация, финальное тестирование 