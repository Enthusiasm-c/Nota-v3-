# Итоги: Автоматическое преобразование единиц веса

## Что было добавлено

Реализован инструмент для автоматического преобразования весовых единиц в килограммы в накладных.

## Основные функции

### 1. `convert_weight_to_kg(quantity, unit, price_per_unit)`
Преобразует вес из любой поддерживаемой единицы в килограммы с автоматическим пересчетом цены.

### 2. `should_convert_to_kg(quantity, unit)`
Определяет, нужно ли выполнять преобразование на основе единицы и количества.

## Ключевые особенности

1. **Умное преобразование граммов**:
   - Граммы преобразуются в кг только если их ≥ 1000
   - Маленькие количества (например, специи) остаются в граммах

2. **Поддержка множества единиц**:
   - Граммы: g, gr, gm, gram, grams, г, гр
   - Миллиграммы: mg, мг
   - Тонны: t, ton, tonne, т
   - Фунты: lb, lbs, pound, pounds
   - Унции: oz, ounce, ounces

3. **Автоматический пересчет цены**:
   - При преобразовании единиц автоматически корректируется цена за единицу
   - Общая стоимость позиции остается неизменной

4. **Интеграция в постобработку**:
   - Преобразование автоматически применяется ко всем позициям при обработке накладной
   - Не требует дополнительных действий от пользователя

## Примеры преобразований

```
2500 g → 2.5 kg (сахар)
50 g → 50 g (шафран, не преобразуется)
0.5 t → 500 kg (пшеница)
10 lb → 4.536 kg (импортный сыр)
5,000,000 mg → 5 kg (витаминный порошок)
```

## Преимущества

1. **Единообразие**: Крупные партии автоматически приводятся к килограммам
2. **Гибкость**: Маленькие количества остаются в удобных единицах
3. **Точность**: Исключены ошибки ручного пересчета
4. **Прозрачность**: Все преобразования логируются

## Файлы

- **Основная логика**: `app/utils/data_utils.py`
- **Интеграция**: `app/postprocessing.py`
- **Тесты**: `tests/test_weight_conversion.py` (18 тестов)
- **Документация**: `docs/WEIGHT_CONVERSION.md`
- **Пример**: `examples/weight_conversion_example.py`

## Результат

Функциональность успешно реализована и протестирована. Все существующие тесты продолжают работать, что подтверждает обратную совместимость.