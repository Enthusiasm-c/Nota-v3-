DIVIDER_LINES_DEBUG: ['────────────────────────────────────────', '────────────────────────────────────────────────────────────────────', '────────────────────────────────────────────────────────────────────', '────────────────────────────────────────────────────────────────────', '──────────────────────']
TABLE_BLOCK_DEBUG:

#  NAME                     QTY UNIT            —           — STATUS
────────────────────────────────────────────────────────────────────
1  olive oil orille 5lit…     2 gh              —           — ❓ not found
2  lumajang                  30 kg              —           — ❓ not found
3  verylongproductnameth…     1 kg      1 235 IDR           — ✅ ok
────────────────────────────────────────────────────────────────────

F
=================================== FAILURES ===================================
__________________________ test_report_layout_strict ___________________________

    def test_report_layout_strict():
        parsed_data = {"supplier": "UD. WIDI WIGUNA", "date": "2025-04-29"}
        match_results = [
            {
                "name": "olive oil orille 5liter",
                "qty": 2,
                "unit": "gh",
                "price": None,
                "status": "unknown",
            },
            {
                "name": "lumajang",
                "qty": 30,
                "unit": "kg",
                "price": None,
                "status": "unknown",
            },
            {
                "name": "verylongproductnamethatiswaytoolong",
                "qty": 1,
                "unit": "kg",
                "price": 1234.56,
                "status": "ok",
            },
        ]
        report = build_report(parsed_data, match_results)
        # Проверяем шапку
        assert re.search(r"📦 \*Supplier:\* UD\\\. WIDI WIGUNA", report)
        assert "📆 *Invoice date:* 2025\\-04\\-29" in report
        # Проверяем разделитель (строка из 10+ символов '─')
        assert re.search(r"─{10,}", report)
        # Проверяем, что ровно две строки-делителя (любая длина, но только строки)
        divider_lines = [line for line in report.splitlines() if set(line) == {"─"}]
        print(f"DIVIDER_LINES_DEBUG: {divider_lines}")
        table_block = report.split("```", 2)[1]
        print(f"TABLE_BLOCK_DEBUG:\n{table_block}")
>       assert len(divider_lines) == 3, f"divider_lines: {divider_lines}"
E       AssertionError: divider_lines: ['────────────────────────────────────────', '────────────────────────────────────────────────────────────────────', '────────────────────────────────────────────────────────────────────', '────────────────────────────────────────────────────────────────────', '──────────────────────']
E       assert 5 == 3
E        +  where 5 = len(['────────────────────────────────────────', '────────────────────────────────────────────────────────────────────', '...───────────────────', '────────────────────────────────────────────────────────────────────', '──────────────────────'])

tests/test_formatter_layout.py:41: AssertionError
=========================== short test summary info ============================
FAILED tests/test_formatter_layout.py::test_report_layout_strict - AssertionE...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
1 failed in 0.05s
2025-05-04 17:41:06,353 - bot - INFO - Cleaned up tmp directory.
