# u0422u0435u0445u043du0438u0447u0435u0441u043au0430u044f u0434u043eu043au0443u043cu0435u043du0442u0430u0446u0438u044f Nota-v3

u0412 u044du0442u043eu043c u0440u0430u0437u0434u0435u043bu0435 u0441u043eu0431u0440u0430u043du0430 u0432u0441u044f u0442u0435u0445u043du0438u0447u0435u0441u043au0430u044f u0438u043du0444u043eu0440u043cu0430u0446u0438u044f u043e u043fu0440u043eu0435u043au0442u0435, u0432u043au043bu044eu0447u0430u044f u0430u0440u0445u0438u0442u0435u043au0442u0443u0440u0443, API, u043eu0431u0440u0430u0431u043eu0442u043au0443 u043eu0448u0438u0431u043eu043a u0438 u043eu043fu0442u0438u043cu0438u0437u0430u0446u0438u0438 u043fu0440u043eu0438u0437u0432u043eu0434u0438u0442u0435u043bu044cu043du043eu0441u0442u0438.

## u0421u043eu0434u0435u0440u0436u0430u043du0438u0435

- [API u0438 u043eu0431u0440u0430u0431u043eu0442u043au0430 u043eu0448u0438u0431u043eu043a](./API_ERROR_HANDLING.md) - u0414u043eu043au0443u043cu0435u043du0442u0430u0446u0438u044f u043fu043e u0440u0430u0431u043eu0442u0435 u0441 API u0438 u043eu0431u0440u0430u0431u043eu0442u043au0435 u043eu0448u0438u0431u043eu043a
- [u041eu043fu0442u0438u043cu0438u0437u0430u0446u0438u0438 u043fu0440u043eu0438u0437u0432u043eu0434u0438u0442u0435u043bu044cu043du043eu0441u0442u0438](./PERFORMANCE.md) - u041eu043fu0442u0438u043cu0438u0437u0430u0446u0438u0438 u0434u043bu044f u0443u043bu0443u0447u0448u0435u043du0438u044f u043fu0440u043eu0438u0437u0432u043eu0434u0438u0442u0435u043bu044cu043du043eu0441u0442u0438
- [u0422u0435u0441u0442u043eu0432u044bu0439 u043fu043bu0430u043d](./TEST_PLAN.md) - u041fu043bu0430u043d u0442u0435u0441u0442u0438u0440u043eu0432u0430u043du0438u044f u0438 u043cu0435u0442u043eu0434u043eu043bu043eu0433u0438u044f
- [u041cu043eu0434u0443u043bu0438 u0438 u043au043eu043cu043fu043eu043du0435u043du0442u044b](./MODULES.md) - u041eu043fu0438u0441u0430u043du0438u0435 u043eu0441u043du043eu0432u043du044bu0445 u043cu043eu0434u0443u043bu0435u0439 u0441u0438u0441u0442u0435u043cu044b

## u041au043bu044eu0447u0435u0432u044bu0435 u0442u0435u0445u043du043eu043bu043eu0433u0438u0438

### OCR u0441 OpenAI Vision API

Nota-v3 u0438u0441u043fu043eu043bu044cu0437u0443u0435u0442 OpenAI Vision API (gpt-4o) u0434u043bu044f u0440u0430u0441u043fu043eu0437u043du0430u0432u0430u043du0438u044f u0442u0435u043au0441u0442u0430 u043du0430 u0444u043eu0442u043eu0433u0440u0430u0444u0438u044fu0445 u043du0430u043au043bu0430u0434u043du044bu0445. u0414u043bu044f u044du0442u043eu0433u043e:

- u0424u043eu0442u043e u043fu0440u0435u043eu0431u0440u0430u0437u0443u0435u0442u0441u044f u0432 Base64
- u041fu0440u043eu043cu043fu0442 u0438u0437 `prompts/invoice_ocr_en_v0.3.txt` u043eu0442u043fu0440u0430u0432u043bu044fu0435u0442u0441u044f u0432u043cu0435u0441u0442u0435 u0441 u0438u0437u043eu0431u0440u0430u0436u0435u043du0438u0435u043c
- u041fu043eu043bu0443u0447u0435u043du043du044bu0439 JSON u0432u0430u043bu0438u0434u0438u0440u0443u0435u0442u0441u044f u0447u0435u0440u0435u0437 Pydantic u043cu043eu0434u0435u043bu0438

u0414u043bu044f u0442u0435u0441u0442u0438u0440u043eu0432u0430u043du0438u044f u0434u043eu0441u0442u0443u043fu043du044b u0434u0432u0430 u0440u0435u0436u0438u043cu0430:
- **Stub mode** (u043fu043e u0443u043cu043eu043bu0447u0430u043du0438u044e): u0411u0435u0437 u0437u0430u043fu0440u043eu0441u043eu0432 u043a OpenAI, u0440u0430u0431u043eu0442u0430u0435u0442 u043eu0444u0444u043bu0430u0439u043d
- **Live mode**: u0420u0435u0430u043bu044cu043du044bu0435 u0437u0430u043fu0440u043eu0441u044b u043a OpenAI API

### u0420u0435u0434u0430u043au0442u0438u0440u043eu0432u0430u043du0438u0435 u0441 GPT-3.5-turbo

u0414u043bu044f u043eu0431u0440u0430u0431u043eu0442u043au0438 u043au043eu043cu0430u043du0434 u043du0430 u0435u0441u0442u0435u0441u0442u0432u0435u043du043du043eu043c u044fu0437u044bu043au0435 u0438u0441u043fu043eu043bu044cu0437u0443u0435u0442u0441u044f GPT-3.5-turbo u0447u0435u0440u0435u0437 OpenAI Assistant API:

- u041cu043eu0434u0443u043bu044c `app/assistants/client.py` u043eu0431u0435u0441u043fu0435u0447u0438u0432u0430u0435u0442 u0432u0437u0430u0438u043cu043eu0434u0435u0439u0441u0442u0432u0438u0435 u0441 API
- u041cu043eu0434u0443u043bu044c `app/assistants/intent_adapter.py` u043du043eu0440u043cu0430u043bu0438u0437u0443u0435u0442 u043eu0442u0432u0435u0442u044b
- u041cu043eu0434u0443u043bu044c `app/edit/apply_intent.py` u043fu0440u0438u043cu0435u043du044fu0435u0442 u0438u043du0442u0435u043du0442u044b u043a u0434u0430u043du043du044bu043c

### Fuzzy Matching

u0414u043bu044f u0441u043eu043fu043eu0441u0442u0430u0432u043bu0435u043du0438u044f u043fu043eu0437u0438u0446u0438u0439 u0438u0437 OCR u0441 u043fu0440u043eu0434u0443u043au0442u0430u043cu0438 u0438u0437 u043au0430u0442u0430u043bu043eu0433u0430 u0438u0441u043fu043eu043bu044cu0437u0443u0435u0442u0441u044f u0433u0438u0431u0440u0438u0434u043du0430u044f u0441u0442u0440u0430u0442u0435u0433u0438u044f:

- u0422u043eu0447u043du043eu0435 u0441u043eu043fu043eu0441u0442u0430u0432u043bu0435u043du0438u0435 (exact match)
- u041du0435u0447u0435u0442u043au043eu0435 u0441u043eu043fu043eu0441u0442u0430u0432u043bu0435u043du0438u0435 (fuzzy matching) u043du0430 u043eu0441u043du043eu0432u0435 u0430u043bu0433u043eu0440u0438u0442u043cu0430 u041bu0435u0432u0435u043du0448u0442u0435u0439u043du0430
- u041fu0440u043eu0432u0435u0440u043au0430 u0435u0434u0438u043du0438u0446 u0438u0437u043cu0435u0440u0435u043du0438u044f
- u041fu0440u0435u0434u043bu043eu0436u0435u043du0438u044f u0442u043eu043f-5 u043fu043eu0445u043eu0436u0438u0445 u043fu0440u043eu0434u0443u043au0442u043eu0432

### u0414u0435u043au043eu0440u0430u0442u043eu0440u044b u0434u043bu044f u043eu0431u0440u0430u0431u043eu0442u043au0438 u043eu0448u0438u0431u043eu043a API

u0420u0435u0430u043bu0438u0437u043eu0432u0430u043du044b u0441u043fu0435u0446u0438u0430u043bu0438u0437u0438u0440u043eu0432u0430u043du043du044bu0435 u0434u0435u043au043eu0440u0430u0442u043eu0440u044b u0434u043bu044f u043eu0431u0440u0430u0431u043eu0442u043au0438 u043eu0448u0438u0431u043eu043a API:

- `with_retry_backoff` - u0414u043bu044f u0441u0438u043du0445u0440u043eu043du043du044bu0445 u0444u0443u043du043au0446u0438u0439
- `with_async_retry_backoff` - u0414u043bu044f u0430u0441u0438u043du0445u0440u043eu043du043du044bu0445 u0444u0443u043du043au0446u0438u0439
- `with_progress_stages` - u0414u043bu044f u043cu043du043eu0433u043eu044du0442u0430u043fu043du044bu0445 u043eu043fu0435u0440u0430u0446u0438u0439
