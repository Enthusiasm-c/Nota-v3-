# Тестовый план для Sprint C-5 "Диалоговое редактирование с GPT"

## Цель тестирования

Проверить работоспособность новой функциональности диалогового редактирования с использованием GPT-3.5-turbo, реализованной в рамках Sprint C-5:

1. Передача команд пользователя в GPT-3.5-turbo
2. Разбор JSON-интента и применение изменений в отчёте
3. Обновление интерфейса с сохранением упрощённой клавиатуры редактирования

## Тест-кейсы

### 1. Редактирование цены (test_free_edit_price.py)

**Входные данные:**
- Накладная с 2 ошибочными строками
- Пользователь находится в состоянии `EditFree.awaiting_input`
- Команда пользователя: "строка 2 цена 95000"

**Ожидаемый результат:**
- Поле price второй строки = 95000
- Количество ошибок уменьшилось на 1
- Отчёт пересобран и отправлен с parse_mode="HTML"
- Логи отображают передачу запроса в GPT и успешное выполнение

### 2. Редактирование даты (test_free_edit_date.py)

**Входные данные:**
- Накладная с пустым полем даты
- Пользователь находится в состоянии `EditFree.awaiting_input`
- Команда пользователя: "дата 16 апреля"

**Ожидаемый результат:**
- Дата установлена как "2025-04-16"
- Отчёт пересобран и отправлен с parse_mode="HTML"
- Клавиатура не содержит кнопку "✅ Подтвердить" (так как есть другие ошибки)
- Логи отображают передачу запроса в GPT и успешное выполнение

### 3. Тесты компонентов apply_intent (test_apply_intent.py)

**Тесты:**
- `test_set_price` - проверка корректного изменения цены и статуса позиции
- `test_set_date` - проверка корректного изменения даты
- `test_apply_intent_price` - проверка работы функции apply_intent для изменения цены
- `test_apply_intent_date` - проверка работы функции apply_intent для изменения даты

## Критерии успеха

1. **Функциональные критерии:**
   - Все unit-тесты выполняются успешно
   - GPT-3.5-turbo правильно интерпретирует команды пользователя
   - Изменения корректно применяются к данным
   - Интерфейс обновляется согласно статусу накладной

2. **Производительность:**
   - Время выполнения запроса к GPT-3.5-turbo не превышает 3 секунды
   - Логи содержат запись "Assistant run ok in X.X s"

3. **Обработка ошибок:**
   - Система корректно обрабатывает неизвестные команды
   - При отсутствии соединения или ошибке API - пользователь получает адекватное сообщение

4. **Логирование:**
   - В логах присутствует запись "FREE EDIT → [текст команды]"
   - Время выполнения запроса к GPT фиксируется

## Инструменты тестирования

1. **pytest** - для автоматизированного тестирования
2. **unittest.mock** - для изоляции компонентов при тестировании
3. **Ручное тестирование** - для проверки полного E2E цикла

## Тестовые окружения

1. **Локальное окружение** - для быстрого разработческого тестирования
2. **CI-pipeline** - для автоматического запуска тестов при каждом коммите

## Ответственные за тестирование

Команда разработки и QA-инженеры проекта Nota AI.